<?php
include 'database/db.php';

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $nama_lengkap = $_POST['nama_lengkap'];
    $email = $_POST['email'];
    $password = password_hash($_POST['password'], PASSWORD_BCRYPT);
    $role = $_POST['role'];
    $telepon = $_POST['telepon'] ?? null;
    $kelas = ($_POST['role'] === 'siswa') ? $_POST['kelas'] ?? null : null;
    $mata_pelajaran = ($_POST['role'] === 'guru') ? $_POST['mata_pelajaran'] ?? null : null;

    try {
        $sql = "INSERT INTO users (nama_lengkap, email, password, telepon, role, kelas, mata_pelajaran, created_at) 
                VALUES (:nama_lengkap, :email, :password, :telepon, :role, :kelas, :mata_pelajaran, NOW())";

        $stmt = $pdo->prepare($sql);

        // Mengikat parameter
        $stmt->bindParam(':nama_lengkap', $nama_lengkap);
        $stmt->bindParam(':email', $email);
        $stmt->bindParam(':password', $password);
        $stmt->bindParam(':telepon', $telepon);
        $stmt->bindParam(':role', $role);
        $stmt->bindParam(':kelas', $kelas);
        $stmt->bindParam(':mata_pelajaran', $mata_pelajaran);

        if ($stmt->execute()) {
            echo "<script>alert('Registrasi berhasil! Silakan login.'); window.location='login.php';</script>";
        } else {
            throw new Exception("Error: " . $stmt->errorInfo()[2]);
        }
    } catch (Exception $e) {
        echo "<script>alert('Registrasi gagal: {$e->getMessage()}');</script>";
    }
}
?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>E-LEARNING</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">
    
    <!-- Favicon -->
    <link href="assets/img/logo new.png" rel="icon">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link href="assets/css/warna.css" rel="stylesheet">
     <img class="img-fluid position-absolute w-100 h-100" src="assets/img/login.jpg" alt="" style="object-fit: cover;">
     <link href="assets/css/warna.css" rel="stylesheet">

</head>
</head>

<body>
    <div class="card">
        <div class="card-header text-center">
            <h3>Register</h3>
        </div>
        <div class="card-body">
            <form method="POST" action="">
                <div class="mb-1">
                    <label for="nama_lengkap" class="form-label">Nama Lengkap</label>
                    <input type="text" class="form-control" id="nama_lengkap" name="nama_lengkap" required>
                </div>
                <div class="mb-1">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="mb-1">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                </div>
                <div class="mb-1">
                    <label for="role" class="form-label">Role</label>
                    <select class="form-select" id="role" name="role" required onchange="toggleFields()">
                    <option value="#">Pilih role</option>
                        <option value="admin">Admin</option>
                        <option value="guru">Guru</option>
                        <option value="siswa">Siswa</option>
                    </select>
                </div>
                <!-- Form untuk Nomor Telepon -->
                <div class="mb-1" id="telepon-container" style="display: none;">
                    <label for="telepon" class="form-label">Telepon</label>
                    <input type="text" class="form-control" id="telepon" name="telepon" placeholder="Masukkan Nomor Telepon">
                </div>
                <!-- Form untuk Kelas (Hanya Siswa) -->
                <div class="mb-1" id="kelas-container" style="display: none;">
                    <label for="kelas" class="form-label">Kelas</label>
                    <select class="form-select" id="kelas" name="kelas" onchange="toggleCustomInput()">
                        <option value="#">pilih</option>    
                        <option value="10-IPS-1">10-IPS-1</option>
                        <option value="10-IPS-2">10-IPS-2</option>
                        <option value="10-IPS-3">10-IPS-3</option>
                        <option value="10-IPA-1">10-IPA-1</option>
                        <option value="10-IPA-2">10-IPA-2</option>
                        <option value="10-IPA-3">10-IPA-3</option>
                        
                        <option value="11-IPS-1">11-IPS-1</option>
                        <option value="11-IPS-2">11-IPS-2</option>
                        <option value="11-IPS-3">11-IPS-3</option>
                        <option value="11-IPA-1">11-IPA-1</option>
                        <option value="11-IPA-2">11-IPA-2</option>
                        <option value="11-IPA-3">11-IPA-3</option>
                
                        <option value="12-IPS-1">12-IPS-1</option>
                        <option value="12-IPS-2">12-IPS-2</option>
                        <option value="12-IPS-3">12-IPS-3</option>
                        <option value="12-IPA-1">12-IPA-1</option>
                        <option value="12-IPA-2">12-IPA-2</option>
                        <option value="12-IPA-3">12-IPA-3</option>
                        <option value="custom">Custom</option>
                    </select>
                    <input type="text" class="form-control mt-2" id="kelas_custom" name="kelas_custom" placeholder="Masukkan Kelas Anda" style="display: none;">
                </div>
                <!-- Form untuk Mata Pelajaran (Hanya Guru) -->
                <div class="mb-1" id="mata-pelajaran-container" style="display: none;">
                    <label for="mata_pelajaran" class="form-label">Mata Pelajaran</label>
                    <select class="form-select" id="mata_pelajaran" name="mata_pelajaran">
                        <option value="1">Matematika</option>
                        <option value="2">Bahasa Indonesia</option>
                        <option value="3">Fisika</option>
                        <option value="4">kimia</option>
                        <option value="5">PJOK</option>
                        <option value="6">agama</option>
                        <option value="7">seni</option>
                        <option value="8">biologi</option>
                        <option value="9">bahasa inggris</option>
                        <option value="10">ekonomi</option>
                        <option value="11">sejarah</option>
                        <option value="12">pertanian</option>
                        <option value="13">perikanan</option>
                        <option value="14">TIK</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">Register</button>
            </form>
          <p class="text-center mt-1">Already have an account? <a href="login.php">Login here</a></p>
        </div>
    </div>
    <script>
        function toggleFields() {
            const role = document.getElementById('role').value;
            const teleponContainer = document.getElementById('telepon-container');
            const kelasContainer = document.getElementById('kelas-container');
            const mataPelajaranContainer = document.getElementById('mata-pelajaran-container');
            
            if (role === 'siswa') {
                teleponContainer.style.display = 'block';
                kelasContainer.style.display = 'block';
                mataPelajaranContainer.style.display = 'none';
            } else if (role === 'guru') {
                teleponContainer.style.display = 'block';
                kelasContainer.style.display = 'none';
                mataPelajaranContainer.style.display = 'block';
            } else {
                teleponContainer.style.display = 'none';
                kelasContainer.style.display = 'none';
                mataPelajaranContainer.style.display = 'none';
            }
        }

        function toggleCustomInput() {
            const kelas = document.getElementById('kelas').value;
            const customInput = document.getElementById('kelas_custom');
            customInput.style.display = kelas === 'custom' ? 'block' : 'none';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
